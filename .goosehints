# Claude RPG - Goose Development Hints

## Project Overview
This is an isometric RPG game built with Python and Pygame. The game features a player character exploring a large world, fighting enemies, collecting items, and managing inventory/equipment.

## Development Notes
**IMPORTANT**: The user will be running the game during development sessions. The game can be started with:
```bash
cd /Users/mnovich/Development/claude-rpg && uv run claude-rpg
```

## Architecture Overview

### Core Game Loop
1. **Entry Point**: `main.py` â†’ `src/main.py:main()` â†’ `src.main:main` (via pyproject.toml)
2. **Game Controller**: `Game` class manages all game states and systems
3. **Game States**: MENU â†’ PLAYING â†’ PAUSED â†’ GAME_OVER (with transitions)
4. **Main Systems**: Asset Loading â†’ Audio â†’ Level â†’ Player â†’ UI â†’ Save/Load

### Class Hierarchy & Dependencies
```
Game (game.py) - Main controller
â”œâ”€â”€ AssetLoader (assets.py) - Loads sprites, sounds, music
â”‚   â””â”€â”€ AudioManager (audio.py) - Handles all audio/music
â”œâ”€â”€ MainMenu (menu.py) - Menu system with music integration
â”œâ”€â”€ Level (level.py) - World generation, entity management, UI rendering
â”‚   â”œâ”€â”€ IsometricRenderer (isometric.py) - 2Dâ†’Iso coordinate conversion
â”‚   â”œâ”€â”€ Entity (entity.py) - Base class for all game objects
â”‚   â”‚   â”œâ”€â”€ NPC - Non-player characters with dialog
â”‚   â”‚   â”œâ”€â”€ Enemy - Combat entities with AI
â”‚   â”‚   â””â”€â”€ Item - Collectible objects with effects
â”‚   â””â”€â”€ Player (player.py) - Player character with inventory
â”‚       â””â”€â”€ Inventory (inventory.py) - Item management UI
â”œâ”€â”€ SaveSystem (save_system.py) - Game persistence
â”œâ”€â”€ Settings (settings.py) - Configuration management
â””â”€â”€ GameLog (game_log.py) - Message logging system
```

### File Size & Complexity (Lines of Code)
- **level.py** (850 lines) - Largest file, handles world generation, entity spawning, UI rendering
- **player.py** (584 lines) - Player mechanics, inventory, combat, movement
- **entity.py** (517 lines) - All game entities (NPCs, enemies, items) with sprite loading
- **menu.py** (506 lines) - Enhanced menu system with visual effects and music
- **audio.py** (354 lines) - Comprehensive audio system with music/SFX management
- **game.py** (252 lines) - Main game controller and state management
- **inventory.py** (244 lines) - Inventory UI with sprite rendering
- **assets.py** (162 lines) - Asset loading with audio integration
- **isometric.py** (128 lines) - Coordinate conversion utilities
- **game_log.py** (129 lines) - Message logging system
- **save_system.py** (93 lines) - JSON-based save/load system
- **settings.py** (68 lines) - Configuration management

## Recent Major Updates (Latest Session)
### âœ… Bottom Menu UI Fixes
- **Fixed overlapping slots**: Weapon and armor slots now have proper spacing (110px apart instead of 80px)
- **Larger slots**: Increased slot size from 60x60 to 80x80 pixels for better text fit
- **Better positioning**: Moved slots down by 20px (from Y=10 to Y=30) for improved layout
- **Sprite rendering**: Added proper sprite rendering for equipped weapons and armor in bottom menu
- **Text positioning**: Fixed weapon and armor name positioning below slots

### âœ… Music System Integration
- **Added background music support**: Integrated `menu_music.mp3` and `game_music.mp3`
- **Smart music transitions**: Menu music plays in menus, game music during gameplay
- **Volume control**: Music volume set to 15% (0.15) for ambient background audio
- **Pause/resume functionality**: Music pauses with game, resumes on return
- **Fade transitions**: 1000ms fade-in/out effects for smooth music changes
- **State-based music**: Automatic music switching based on game state (menu/game/pause/game over)

## Current Status
**RESOLVED ISSUES**:
1. âœ… Bottom menu UI layout and spacing
2. âœ… Equipment slot sprite rendering 
3. âœ… Background music integration
4. âœ… Music volume balancing

**WORKING FEATURES**:
- Inventory system with proper sprite display
- Equipment slots showing actual item sprites
- Background music system with appropriate volume levels
- Smooth transitions between menu and game music
- Proper UI spacing and text positioning

## Project Structure
```
/Users/mnovich/Development/claude-rpg/
â”œâ”€â”€ src/                  # Main source code (Python package)
â”‚   â”œâ”€â”€ __init__.py       # Package initialization (4 lines)
â”‚   â”œâ”€â”€ main.py           # Entry point (31 lines)
â”‚   â”œâ”€â”€ game.py           # Main game controller (252 lines)
â”‚   â”œâ”€â”€ level.py          # World generation & UI rendering (850 lines) â­ LARGEST
â”‚   â”œâ”€â”€ player.py         # Player mechanics & inventory (584 lines)
â”‚   â”œâ”€â”€ entity.py         # Game entities (NPCs, enemies, items) (517 lines)
â”‚   â”œâ”€â”€ menu.py           # Menu system with music (506 lines)
â”‚   â”œâ”€â”€ audio.py          # Audio system with music/SFX (354 lines)
â”‚   â”œâ”€â”€ inventory.py      # Inventory UI rendering (244 lines)
â”‚   â”œâ”€â”€ assets.py         # Asset loading system (162 lines)
â”‚   â”œâ”€â”€ isometric.py      # Coordinate conversion utilities (128 lines)
â”‚   â”œâ”€â”€ game_log.py       # Message logging system (129 lines)
â”‚   â”œâ”€â”€ save_system.py    # JSON save/load system (93 lines)
â”‚   â””â”€â”€ settings.py       # Configuration management (68 lines)
â”œâ”€â”€ assets/               # Game assets
â”‚   â”œâ”€â”€ images/           # Sprites (PNG format)
â”‚   â”‚   â”œâ”€â”€ [tiles]       # grass_tile, stone_tile, water_tile, wall_tile, dirt_tile
â”‚   â”‚   â”œâ”€â”€ [characters]  # player_sprite, goblin_sprite, orc_boss_sprite, npc_shopkeeper
â”‚   â”‚   â”œâ”€â”€ [objects]     # tree, rock, menu_background
â”‚   â”‚   â”œâ”€â”€ [weapons]     # iron_sword, steel_axe, bronze_mace, silver_dagger, war_hammer
â”‚   â”‚   â”œâ”€â”€ [armor]       # leather_armor, chain_mail, plate_armor, studded_leather, scale_mail
â”‚   â”‚   â””â”€â”€ [consumables] # health_potion, mana_potion
â”‚   â””â”€â”€ sounds/           # Audio files
â”‚       â”œâ”€â”€ menu_music.mp3    # Background music for menus
â”‚       â”œâ”€â”€ game_music.mp3    # Background music for gameplay
â”‚       â””â”€â”€ [SFX categories]/ # combat/, ui/, environment/, magic/, creatures/, ambient/
â”œâ”€â”€ main.py               # Alternative entry point (37 lines)
â”œâ”€â”€ pyproject.toml        # Project configuration & dependencies
â”œâ”€â”€ test_game.py          # Test file (95 lines)
â””â”€â”€ .goosehints          # This file - development guidance
```

## Key Navigation Points for Agents

### ğŸ¯ Common Development Tasks & File Locations:

#### UI/Interface Issues:
- **Bottom Menu**: `src/level.py` lines ~700-800 (`render_ui()` method)
- **Inventory Display**: `src/inventory.py` lines ~40-150 (`render()` method)
- **Menu System**: `src/menu.py` lines ~400-500 (`render_menu_items()` method)
- **Game HUD**: `src/level.py` lines ~600-700 (player stats, game log)

#### Game Mechanics:
- **Player Movement**: `src/player.py` lines ~100-200 (`handle_input()`, `update()`)
- **Combat System**: `src/player.py` lines ~250-350 (`attack_enemy()`, `take_damage()`)
- **Item System**: `src/entity.py` lines ~400-500 (`Item` class)
- **Inventory Logic**: `src/player.py` lines ~350-450 (`use_item()`, equipment methods)

#### World & Entities:
- **Level Generation**: `src/level.py` lines ~50-200 (`generate_level()`, building creation)
- **Entity Spawning**: `src/level.py` lines ~200-350 (`spawn_entities()`, `spawn_items()`)
- **Enemy AI**: `src/entity.py` lines ~250-350 (`Enemy.update()`)
- **Collision Detection**: `src/level.py` lines ~450-550 (`check_collision()`)

#### Audio & Assets:
- **Music Control**: `src/audio.py` lines ~100-200 (music methods)
- **Asset Loading**: `src/assets.py` lines ~50-150 (`load_images()`, `load_sounds()`)
- **Sprite Creation**: `src/entity.py` lines ~50-100 (sprite creation methods)

#### Save/Load & Settings:
- **Game Persistence**: `src/save_system.py` (entire file, 93 lines)
- **Configuration**: `src/settings.py` (entire file, 68 lines)
- **Game States**: `src/game.py` lines ~150-250 (state management)

### ğŸ”§ System Integration Points:
- **Audio Manager Access**: `getattr(self.asset_loader, 'audio_manager', None)`
- **Asset Loader Integration**: Passed to all entities via constructor
- **Game State Transitions**: `src/game.py` lines ~80-150 (event handling)
- **Coordinate Conversion**: `src/isometric.py` (world â†” screen coordinates)

## Key Files and Recent Changes

### 1. src/level.py - Bottom Menu UI (Lines ~700-800)
- **Equipment display section**: Enhanced weapon and armor slot rendering
- **Sprite integration**: Added proper sprite scaling and positioning
- **Layout improvements**: Better spacing and text positioning

### 2. src/audio.py - Music System
- **Music loading**: Added `load_music()` method for MP3 files
- **Music control**: Added play_music(), stop_music(), pause_music(), resume_music()
- **Volume management**: Set music volume to 15% for ambient background audio
- **State tracking**: Current music tracking and playback status

### 3. src/menu.py - Music Integration
- **Music control methods**: Added start_menu_music() and start_game_music()
- **State transitions**: Music changes appropriately when entering/exiting game
- **Audio manager integration**: Proper audio manager access and control

### 4. src/game.py - Game State Music
- **Pause music handling**: Music pauses when game is paused
- **Game over music**: Returns to menu music on game over
- **State transition music**: Proper music control during state changes

## Asset Loading System
- All sprites are successfully loaded (console shows "Loaded image: iron_sword", etc.)
- Music files are loaded from assets/sounds/ directory
- Asset loader is properly integrated and working
- Individual sprite files exist for all items in assets/images/

## Audio System Details
### Music Files:
- `menu_music.mp3` - Background music for menus
- `game_music.mp3` - Background music during gameplay

### Volume Levels:
- Master Volume: 100% (1.0)
- SFX Volume: 70% (0.7)
- UI Volume: 60% (0.6)
- Ambient Volume: 40% (0.4)
- **Music Volume: 15% (0.15)** - Quiet ambient background

### Music Behavior:
- **Menu Music**: Plays in main menu, pause menu, game over screen
- **Game Music**: Plays during active gameplay
- **Transitions**: 1000ms fade-in/out between music changes
- **Pause/Resume**: Music pauses with game, resumes on return

## Recent Accomplishments
1. âœ… Successfully integrated tree.png and rock.png sprites
2. âœ… Fixed collision detection system  
3. âœ… Balanced enemy movement speeds
4. âœ… Enhanced inventory system with sprite support
5. âœ… Added proper equipment slots with visual previews
6. âœ… **Fixed bottom menu UI - larger slots, proper spacing, sprite rendering**
7. âœ… **Integrated background music system with volume control**
8. âœ… **Added music state management and transitions**

## How to Test
1. Run: `cd /Users/mnovich/Development/claude-rpg && uv run claude-rpg`
2. **Music Testing**: 
   - Menu music should play on startup
   - Game music should start when beginning new game or loading save
   - Music should pause when pressing ESC (pause menu)
   - Music should resume when returning to game
   - Music should return to menu music on game over
3. **UI Testing**:
   - Start new game, pick up weapons/armor, equip them
   - Check bottom menu shows proper sprites and text
   - Verify slots don't overlap and text fits properly
4. Press 'I' to open inventory and verify sprite display

## Expected Behavior
- Bottom menu displays proper weapon/armor sprites with good spacing
- Background music plays appropriately based on game state
- Music volume is ambient (15%) and doesn't interfere with gameplay
- Equipment slots are large enough for text and properly spaced
- Smooth music transitions between menu and game states

## Sprite Files Available
All individual sprite files are loaded successfully:
- Weapons: iron_sword, steel_axe, bronze_mace, silver_dagger, war_hammer
- Armor: leather_armor, chain_mail, plate_armor, studded_leather, scale_mail  
- Consumables: health_potion, mana_potion
- Music: menu_music.mp3, game_music.mp3

## Current State
- Game runs successfully with background music
- Player can move, pick up items, equip items with proper UI display
- Bottom menu shows equipped items with actual sprites (not colored shapes)
- Music system works with appropriate volume levels and state transitions
- All major UI and audio issues have been resolved

## Development Patterns & Best Practices
- **Asset Loading**: Always pass `asset_loader` to entity constructors
- **Audio Integration**: Access via `getattr(self.asset_loader, 'audio_manager', None)`
- **Sprite Scaling**: Use `pygame.transform.scale()` for UI elements
- **State Management**: Use Game class state constants (STATE_MENU, STATE_PLAYING, etc.)
- **Coordinate Conversion**: Use IsometricRenderer for world â†” screen conversion
- **Error Handling**: Check for None values when accessing audio_manager or sprites
- **UI Positioning**: Use relative positioning and proper spacing calculations
- **Music Transitions**: Always use fade-in/out for smooth audio transitions